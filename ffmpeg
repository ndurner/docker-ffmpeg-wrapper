#!/bin/zsh

# Create a temporary directory
temp_dir=$(mktemp -d)
trap 'rm -rf "$temp_dir"' EXIT

# Function to process file path
process_file_path() {
    local file_path="$1"
    local temp_file="$temp_dir/$(basename "$file_path")"
    if [[ -f "$file_path" ]]; then
        cp "$file_path" "$temp_file"
    fi
    echo "/workdir/$(basename "$temp_file")"
}

# Prepare arguments for Docker
docker_args=()
output_to_stdout=false
for arg in "$@"; do
    if [[ "$arg" == "-" ]]; then
        output_to_stdout=true
        docker_args+=("$arg")
    elif [[ -e "$arg" ]] || [[ "$arg" == */* ]]; then
        # If argument is a file/directory or looks like a path
        docker_args+=("$(process_file_path "$arg")")
    else
        docker_args+=("$arg")
    fi
done

# Run FFmpeg in Docker
if $output_to_stdout; then
    echo "docker run --rm -i -v \"$temp_dir:/workdir\" -w /workdir jrottenberg/ffmpeg ${docker_args[@]}"
    docker run --rm -i -v "$temp_dir:/workdir" -w /workdir jrottenberg/ffmpeg "${docker_args[@]}"
else
    echo "docker run --rm -v \"$temp_dir:/workdir\" -w /workdir jrottenberg/ffmpeg ${docker_args[@]}"
    docker run --rm -v "$temp_dir:/workdir" -w /workdir jrottenberg/ffmpeg "${docker_args[@]}"
    # Copy output files back to the current directory
    cp "$temp_dir"/* ./
fi